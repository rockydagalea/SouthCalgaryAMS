<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South Calgary Locale Attendance Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">South Calgary Locale</h1>
        
        <form id="attendanceForm" class="space-y-6">
            <!-- Previous form elements remain the same -->
            <!-- Date Picker -->
            <div>
                <label for="date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                <input type="date" id="date" name="date" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
            </div>

            <!-- Gathering Dropdown -->
            <div>
                <label for="gathering" class="block text-sm font-medium text-gray-700 mb-2">Gathering</label>
                <select id="gathering" name="gathering" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select Gathering</option>
                    <option value="Prayer Meeting Live">Prayer Meeting Live</option>
                    <option value="Prayer Meeting B2 Wed 4:30am">Prayer Meeting B2 Wed 4:30am</option>
                    <option value="Prayer Meeting B3 Wed 7:00pm">Prayer Meeting B3 Wed 7:00pm</option>
                    <option value="Prayer Meeting Other">Prayer Meeting Other</option>
                    <option value="Worship Live">Worship Live</option>
                    <option value="Worship B2 Sat 10:00am">Worship B2 Sat 10:00am</option>
                    <option value="Worship B3 Sun 10:00am">Worship B3 Sun 10:00am</option>
                    <option value="Worship Other">Worship Other</option>
                    <option value="Thanksgiving Live">Thanksgiving Live</option>
                    <option value="Thanksgiving B2 Sun 1:30pm">Thanksgiving B2 Sun 1:30pm</option>
                    <option value="Thanksgiving Other">Thanksgiving Other</option>
                </select>
            </div>

            <!-- Location Dropdown -->
            <div>
                <label for="location" class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                <select id="location" name="location" required
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">Select Location</option>
                    <option value="South Locale">South Locale</option>
                    <option value="Zoom">Zoom</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <!-- Attendee Search -->
            <div>
                <label for="attendee" class="block text-sm font-medium text-gray-700 mb-2">Add Attendee</label>
                <div class="flex space-x-2">
                    <input type="text" id="attendee" placeholder="Search or add new name"
                        class="flex-1 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <button type="button" id="addAttendee" 
                        class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Add
                    </button>
                </div>
            </div>

            <!-- Attendees List -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Attendees</label>
                <div id="attendeesList" class="min-h-[100px] max-h-[200px] overflow-y-auto p-3 border border-gray-300 rounded-md space-y-2">
                </div>
            </div>

            <!-- Submit Button -->
            <div>
                <button type="submit"
                    class="w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                    Submit Attendance
                </button>
            </div>
        </form>
    </div>

    <script>
        // Initial names list
        let names = [
            "Margie Aquino", "Daniel Gegantino", "Ley Mayandia", "Manuel Hosalla", "Ramon Garcia",
    "Victor Diaz", "Grace Biala", "Michael Montemayor", "Ronaldo Sampang", "Imelda Andrada",
    "Josephine Sampang", "Grace Salutal", "Boots Gementera", "Richard Manzano", "Lori Manzano",
    "Lawrence Manzano", "Rommel Gementera", "Gil Macanas", "Lito De Leon", "Jen De Leon",
    "Jellaine De Leon", "Joal Fugaban", "Minhet De Jesus", "Raul De Jesus", "Agustin Menil",
    "Tristan Dizon", "Kharl Malijan", "Levy Lucino", "Jerry Dizon", "Anabel Gaoat",
    "Jersey Dizon", "Darlene Dizon", "Marvin Dando", "Edwin Ong", "Deovito Mosquida",
    "Jannette Magallanes", "Yanie Malibran", "Ringo Tapiru", "Jerry Maquio", "Ronnie de Castro",
    "James Hufana", "Cenly Hufana", "Rodel Hufana", "Charisma Morada", "Jeremy Morada",
    "Dalia Tapiru", "Joni Go", "Jozen Go", "Gilbert Mendoza", "Irenel Cefre",
    "Rona Mendoza", "Fernando Cruz", "Pio David", "Beth David", "Mary Ann Cefre",
    "KC Cefre", "MaryAnn Pelayo", "Ronaldo Pelayo", "Jaybee Catabay", "Jackie Sazon",
    "Omar Sazon", "Kim Regio", "Ricky Lazo", "Mike Capito", "Enesil Capito",
    "Rodante Lozano", "Emz Lozano", "Ricardo Manzano", "Jerico Palileo", "Mark Malibiran",
    "Jamille Capito", "Sidney Dizon", "Rosalia Bing Balbanida", "Jonash Sampang", "Arjay Sampang",
    "Michael Sampang", "Darwin De Jesus", "Alvin Umbac", "Candy Vaughan", "George Tiomico",
    "Marlyn Tiomico", "Andy Malibiran", "Gigi Malibiran", "Elizabeth Gomez", "Belen Miguel",
    "Emil Arguelles", "Tess Arguelles", "Jaime Valmores", "Lolita Valmores", "Federico Basco",
    "Vilma Basco", "Joselito Martisano", "Leo Sanguir", "Agnes De Chaves", "Dominga Salvador",
    "Teody Salvador", "Chris Pineda", "Guillermo Salonga", "Jona Pineda", "Jemverick Salonga",
    "Jeremy Salonga", "Rose Salonga", "Roselyn Tabiano", "Rene Lolong", "Crispen Dulfo",
    "Malosa Dulfo", "Efraim Dulfo", "Ravin Custona", "Eleizar Dulfo", "Christian Tabiano",
    "Luchavez Formentera", "Neriza Formentera", "Eric Arma", "Joven Jamio", "Rowena Jamio",
    "Chris Buzon", "Romelda Buzon", "Jaynard Fernandez", "Maricel Fernandez", "Jackie Magracia",
    "Josefina Magracia", "Remedios Ollero", "Rosalinda Fernandez", "Fernando Fernandez", "Ric Salvador",
    "Evangeline Ancheta", "Jen Moreno", "Dante Merjudio", "Jellen Merjudio", "Luther Luzuriaga",
    "Reggie Mike Galza", "Gina Galza", "Regeanne Galza", "Reyes Corazon", "Mark Luzuriaga",
    "Nemesio Anyayahan", "Celine Anyayahan", "Paul Coralde", "Roberto Fajardo Macapagal", "Ismael Perez",
    "Joy Perez", "Jeremiah Pangan", "Melai Gegantino", "Rocky Dagalea", "Thess Arguelles",
    "Roman Bancolita", "Alexa Salonga", "Mico Malibiran", "Akira De Jesus", "Gian Macanas",
    "Precious De Jesus", "Danie Malibiran", "Timmy Morada", "Breavhin Tapiru", "Federico Soriano",
    "Nancy Gomez", "Joross Tabiano"
        ];

        let selectedAttendees = new Set();

        // Initialize autocomplete
        $(document).ready(function() {
            $("#attendee").autocomplete({
                source: function(request, response) {
                    const term = request.term.toLowerCase();
                    const matches = names.filter(name => 
                        name.toLowerCase().includes(term) && 
                        !selectedAttendees.has(name)
                    );
                    response(matches);
                },
                minLength: 1
            });

            $("#addAttendee").click(function() {
                const name = $("#attendee").val().trim();
                if (name) {
                    addAttendee(name);
                    $("#attendee").val('');
                }
            });

            $("#attendanceForm").submit(function(e) {
                e.preventDefault();
                submitAttendance();
            });
        });

        function addAttendee(name) {
            if (!selectedAttendees.has(name)) {
                selectedAttendees.add(name);
                if (!names.includes(name)) {
                    names.push(name);
                }
                
                const attendeeElement = $(`
                    <div class="flex justify-between items-center bg-gray-50 p-2 rounded">
                        <span>${name}</span>
                        <button type="button" class="text-red-600 hover:text-red-800" onclick="removeAttendee('${name}')">
                            Ã—
                        </button>
                    </div>
                `);
                
                $("#attendeesList").append(attendeeElement);
            }
        }

        function removeAttendee(name) {
            selectedAttendees.delete(name);
            $("#attendeesList").find(`div:contains('${name}')`).remove();
        }

        async function submitAttendance() {
            const formData = {
                date: $("#date").val(),
                gathering: $("#gathering").val(),
                location: $("#location").val(),
                attendees: Array.from(selectedAttendees)
            };

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycby5jhx5b_SLGvBxekA3ii2_ts5GNbUO31p1qKbj26sUYAqCZkyV7CZhqWBiLxgqVLqY/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                alert('Attendance submitted successfully!');
                
                // Reset form
                $("#attendeesList").empty();
                selectedAttendees.clear();
                $("#attendanceForm")[0].reset();
            } catch (error) {
                alert('Error submitting attendance. Please try again.');
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>